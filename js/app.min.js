(()=>{"use strict";const e=document.getElementById("burger-button"),t=document.getElementById("header-menu"),n=e.className,s=t.className;e.addEventListener("click",(function(){e.classList.toggle(`${n}--active`),t.classList.toggle(`${s}--active`),document.body.classList.toggle("body--lock")}));let d=0;const a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-!#$%&?|:";let i="";const l=127;for(let e=32;e<l;e++)i+=String.fromCharCode(e);let c=[];function o(e,t="enc"){0==e&&(y.value="",L.clearRect(0,0,h.width,h.height),w.value="",C.value="",c.length=0,v.classList.remove("option--visible"),B.classList.remove("inputs--visible"),O.classList.remove("result--visible"),b.classList.remove("inputs--decrypt"),_.classList.remove("inputs--decrypt"),A.classList.remove("inputs--decrypt"),U.classList.remove("inputs--decrypt"),R.classList.remove("inputs--decrypt"),N.classList.remove("inputs--encrypt"),S.classList.remove("result--decrypt"),z.classList.remove("result--encrypt")),1==e&&v.classList.add("option--visible"),2==e&&(B.classList.add("inputs--visible"),"enc"==t?N.classList.add("inputs--encrypt"):(b.classList.add("inputs--decrypt"),_.classList.add("inputs--decrypt"),A.classList.add("inputs--decrypt"),U.classList.add("inputs--decrypt"),R.classList.add("inputs--decrypt"))),3==e&&(O.classList.add("result--visible"),"enc"==t?(j.value=C.value,z.classList.add("result--encrypt")):(F.innerText=function(){let e=g(C.value);const t=L.getImageData(0,0,h.width,h.height).data;let n=[];for(let s=W;s<t.length;s+=W){let d=255-t[s+3]-e;d>0&&d<l&&n.push(d)}return n.map((e=>String.fromCharCode(e))).join("")}(),S.classList.add("result--decrypt")))}function r(){if(!y.files[0])return;const e=new Image;e.src=URL.createObjectURL(y.files[0]),e.addEventListener("load",(()=>{h.width=e.width,h.height=e.height,e.width>=G&&e.height>=H?(o(1),setTimeout((function(){L.drawImage(e,0,0,h.width,h.height);let t=L.getImageData(0,0,h.width,h.height).data.length;d=Math.floor(t/W),w.setAttribute("maxlength",d)}),1e3)):o(0)}))}function u(e){e.length==K?C.classList.add("inputs__key-input--success"):C.classList.remove("inputs__key-input--success")}function m(e){const t="enc"==e?w.value:"",n="enc"!=e||t.length>=J,s=C.value,d=8==s.length;let l=!0;for(let e=0;e<t.length;e++)if(-1===i.indexOf(t[e])){l=!1;break}let r=!0;for(let e=0;e<s.length;e++)if(-1===a.indexOf(s[e])){r=!1;break}"enc"==e?(n&&l||(k.classList.add(Q),setTimeout((()=>{k.classList.remove(Q)}),P)),d&&r||(x.classList.add(Q),setTimeout((()=>{x.classList.remove(Q)}),P)),n&&l&&d&&r&&function(){let e=g(C.value);c.length=0;let t=w.value;for(let n=0;n<t.length;n++){let s=t.charCodeAt(n)+e;c.push(s)}const n=L.getImageData(0,0,h.width,h.height).data;let s=0;for(let e=W;e<n.length;e+=W)s<c.length?(n[e+3]=255-c[s],s++):n[e+3]<125?n[e+3]=0:n[e+3]=255;const d=new ImageData(new Uint8ClampedArray(n),h.width,h.height);L.putImageData(d,0,0),o(3),$.href=h.toDataURL(),$.download=y.files[0].name}()):(d&&r||(x.classList.add(Q),setTimeout((()=>{x.classList.remove(Q)}),P)),d&&r&&o(3,"dec"))}function g(e){let t=[];for(let n=0;n<e.length;n++)n%2==0?t.push(e.charCodeAt(n)):t.push("-"+e.charCodeAt(n));return t=Math.abs(t.map((e=>Math.floor(.5*Number(e)))).reduce(((e,t)=>e+t))),t>=V?t=V:t}const p=document.getElementById("drop-area"),y=document.getElementById("input-file"),v=document.getElementById("option-main"),h=document.getElementById("canvas"),L=h.getContext("2d"),E=document.getElementById("button-option__encrypt"),f=document.getElementById("button-option__decrypt"),I=document.querySelectorAll(".encryption__reset"),B=document.getElementById("inputs-main"),b=document.getElementById("inputs__text"),k=document.getElementById("text-tooltip"),w=document.getElementById("input-text"),_=(document.getElementById("inputs__key"),document.getElementById("input-key-text-span")),x=document.getElementById("key-tooltip"),C=document.getElementById("input-key"),D=document.getElementById("input-key-show"),T=document.getElementById("input-key-indicator"),A=document.getElementById("key-generate"),M=document.getElementById("key-paste"),U=document.getElementById("key-copy"),R=document.getElementById("text-encrypt"),N=document.getElementById("text-decrypt"),O=document.getElementById("result-main"),S=document.getElementById("result-enc"),j=document.getElementById("result-key"),$=(document.getElementById("result-key-show"),document.getElementById("canvas-download")),q=document.getElementById("canvas-clipboard"),z=document.getElementById("result-dec"),F=document.getElementById("decrypted-message"),G=512,H=512,J=5,K=8,P=2e3,Q="inputs-tooltip--animate",V=100,W=5e4;p.addEventListener("dragover",(e=>{e.preventDefault(),p.classList.add("drag-over")})),p.addEventListener("dragleave",(e=>{e.preventDefault(),p.classList.remove("drag-over")})),p.addEventListener("drop",(e=>{e.preventDefault(),p.classList.remove("drag-over"),y.files=e.dataTransfer.files,r()})),y.onchange=r,E.addEventListener("click",(()=>o(2,"enc"))),f.addEventListener("click",(()=>o(2,"dec"))),I.forEach((function(e){e.addEventListener("click",(()=>o(0)))})),C.addEventListener("input",(()=>u(C.value))),D.addEventListener("click",(()=>{C.type="password"===C.type?"text":"password",T.classList.toggle("inputs__key-hidden--visible")})),A.addEventListener("click",(()=>C.value=function(){let e="";for(let t=0;t<K;t++){let t=Math.floor(71*Math.random());e+=a[t]}return u(e),e}())),M.addEventListener("click",(function(){navigator.clipboard.readText().then((e=>{C.value=e.slice(0,8),u(C.value)})).catch((e=>console.error("Unable to paste from clipboard: "+e)))})),U.addEventListener("click",(function(){let e=C.value;navigator.clipboard.writeText(e).then((()=>alert("Текст скопійовано в буфер обміну: "+e))).catch((e=>alert("Помилка копіювання: "+e)))})),R.addEventListener("click",(()=>m("enc"))),N.addEventListener("click",(()=>m("dec"))),q.addEventListener("click",(function(){h.toBlob((function(e){const t=new ClipboardItem({"image/png":e});navigator.clipboard.write([t]).then((()=>alert("Image copied to clipboard!"))).catch((function(e){console.error("Error:",e)}))}),"image/png")}))})();